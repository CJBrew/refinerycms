# encoding: utf-8
require "spec_helper"

module Refinery
  module <%= namespacing %>
    describe "Admin" do
      describe "<%= plural_name %>" do
        refinery_login_with :refinery_user
<% if (title = attributes.detect { |a| a.type.to_s == "string" }).present? %>

       describe "<%= plural_name %> list" do
          before do
            FactoryGirl.create(:<%= singular_name %>, :<%= title.name %> => "UniqueTitleOne")
            FactoryGirl.create(:<%= singular_name %>, :<%= title.name %> => "UniqueTitleTwo")
          end

          it "shows two items" do
            visit refinery.<%= namespacing.underscore %>_admin_<%= plural_name %>_path
            page.should have_content("UniqueTitleOne")
            page.should have_content("UniqueTitleTwo")
          end
        end

       describe "when no " do
         before { Refinery::<%= namespacing %>::<%= class_name %>.destroy_all }

         context "<%= plural_name %>" do
           it "shows expected message" do
            visit refinery.<%= plural_name %>_admin_<%= plural_name %>_path

            expect(page).to have_content("You have not received any <%= plural_name %> yet.")

            end
           end
           <% if include_spam? %>
         context "spam <%= plural_name %>" do
            it "shows expected message" do
              visit refinery.spam_<%= plural_name %>_admin_<%= plural_name %>_path

              expect(page).to have_content("Hooray! You don't have any spam.")
            end
         end
          <% end %>
       end

       <% if include_spam? %>

        describe "mark as ham" do

          it "should succeed" do
            visit refinery.<%= namespacing.underscore %>_admin_<%= plural_name %>_path

            within "#actions" do
              click_link ::I18n.t('.<%= singular_name %>.mark_as_ham')
            end

            fail("Implement this test")
        end
        end

        describe "mark as spam" do
          before { FactoryGirl.create(:<%= singular_name %>, :<%= title.name %> => "A <%= title.name %>") }

          it "should succeed" do
            visit refinery.<%= namespacing.underscore %>_admin_<%= plural_name %>_path

            within ".actions" do
              click_link ::I18n.t('mark_as_spam')              
            end

            fail("Implement this test")

          end
        end
      <% end %>

        describe "destroy" do
          before { FactoryGirl.create(:<%= singular_name %>, :<%= title.name %> => "UniqueTitleOne") }

          it "should succeed" do
            visit refinery.<%= namespacing.underscore %>_admin_<%= plural_name %>_path

            click_link "Remove this <%= singular_name.titleize.downcase %> forever"

            page.should have_content("'UniqueTitleOne' was successfully removed.")
            Refinery::<%= namespacing %>::<%= class_name %>.count.should == 0
          end
        end

          describe "destroy from <%= singular_name %> show page" do
          before { FactoryGirl.create(:<%= singular_name %>, :<%= title.name %> => "UniqueTitleOne") }

          it "should succeed" do
            visit refinery.<%= namespacing.underscore %>_admin_<%= singular_name %>_path( :id => '1')

            click_link "Remove this <%= singular_name.titleize.downcase %> forever"

            page.should have_content("'UniqueTitleOne' was successfully removed.")
            Refinery::<%= namespacing %>::<%= class_name %>.count.should == 0
          end
        end
<% end %>
      end
    end
  end
end
